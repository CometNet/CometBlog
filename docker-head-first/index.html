<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
<meta name="referrer" content="no-referrer" />
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"blog.huixing.org","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="Docker 架构原理及简单使用简介了解docker的前生LXCLXC为Linux Container的简写。可以提供轻量级的虚拟化，以便隔离进程和资源，而且不需要提供指令解释机制以及全虚拟化的其他复杂性。相当于C++中的NameSpace。容器有效地将由单个操作系统管理的资源划分到孤立的组中，以更好地在孤立的组之间平衡有冲突的资源使用需求。与传统虚拟化技术相比，它的优势在于：  与宿主机使用同一">
<meta property="og:type" content="article">
<meta property="og:title" content="Docker 深入浅出">
<meta property="og:url" content="http://blog.huixing.org/docker-head-first/index.html">
<meta property="og:site_name" content="Haohao Notes">
<meta property="og:description" content="Docker 架构原理及简单使用简介了解docker的前生LXCLXC为Linux Container的简写。可以提供轻量级的虚拟化，以便隔离进程和资源，而且不需要提供指令解释机制以及全虚拟化的其他复杂性。相当于C++中的NameSpace。容器有效地将由单个操作系统管理的资源划分到孤立的组中，以更好地在孤立的组之间平衡有冲突的资源使用需求。与传统虚拟化技术相比，它的优势在于：  与宿主机使用同一">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://ww1.sinaimg.cn/large/a3eed545ly1gog1ujsdmnj20k007qdi4.jpg">
<meta property="og:image" content="http://ww1.sinaimg.cn/large/a3eed545ly1gog215fvqmj20f2041wej.jpg">
<meta property="og:image" content="https://ww1.sinaimg.cn/large/a3eed545ly1gog24dqkynj20nj0enmyo.jpg">
<meta property="og:image" content="https://ww1.sinaimg.cn/large/a3eed545ly1gog257ec3lj20rk0y3440.jpg">
<meta property="og:image" content="https://ww1.sinaimg.cn/large/a3eed545ly1gog25uxj7ij20j60b9q69.jpg">
<meta property="og:image" content="https://ww1.sinaimg.cn/large/a3eed545ly1gog2etjt6qj20hd0d23zv.jpg">
<meta property="og:image" content="https://ww1.sinaimg.cn/large/a3eed545ly1gog2ikt3usj20l10avabx.jpg">
<meta property="og:image" content="https://ww1.sinaimg.cn/large/a3eed545ly1gog2n8l0pfj20fj095gm6.jpg">
<meta property="og:image" content="https://ww1.sinaimg.cn/large/a3eed545ly1gog2nuwt2tj20gh0av3ze.jpg">
<meta property="og:image" content="https://ww1.sinaimg.cn/large/a3eed545ly1gog2tu7hkij20fd09cjry.jpg">
<meta property="og:image" content="https://ww1.sinaimg.cn/large/a3eed545ly1gog2vdwboqj20h0096wf5.jpg">
<meta property="og:image" content="https://ww1.sinaimg.cn/large/a3eed545ly1gog2wfz9oxj20ln0cjgmg.jpg">
<meta property="og:image" content="https://ww1.sinaimg.cn/large/a3eed545ly1gog32lik13j20ql0gedla.jpg">
<meta property="article:published_time" content="2021-03-11T07:27:27.000Z">
<meta property="article:modified_time" content="2021-03-26T06:13:51.000Z">
<meta property="article:author" content="Tan Hao">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://ww1.sinaimg.cn/large/a3eed545ly1gog1ujsdmnj20k007qdi4.jpg">

<link rel="canonical" href="http://blog.huixing.org/docker-head-first/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Docker 深入浅出 | Haohao Notes</title>
  


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?5202a7e94920d0c374589510b87a35e0";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Haohao Notes</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">DREAM OF TECHNICAL ACHIEVEMENT</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://blog.huixing.org/docker-head-first/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="作者">
      <meta itemprop="description" content="谈浩的个人博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Haohao Notes">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Docker 深入浅出
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-03-11 15:27:27" itemprop="dateCreated datePublished" datetime="2021-03-11T15:27:27+08:00">2021-03-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-03-26 14:13:51" itemprop="dateModified" datetime="2021-03-26T14:13:51+08:00">2021-03-26</time>
              </span>

          
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-copyright"></i>
    </span>
    <span class="post-meta-item-text">作者：</span><span>Tan Hao</span>
  </span>
  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/docker-head-first/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="docker-head-first/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="Docker-架构原理及简单使用"><a href="#Docker-架构原理及简单使用" class="headerlink" title="Docker 架构原理及简单使用"></a>Docker 架构原理及简单使用</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><h3 id="了解docker的前生LXC"><a href="#了解docker的前生LXC" class="headerlink" title="了解docker的前生LXC"></a>了解docker的前生LXC</h3><p>LXC为Linux Container的简写。可以提供轻量级的虚拟化，以便隔离进程和资源，而且不需要提供指令解释机制以及全虚拟化的其他复杂性。相当于C++中的NameSpace。容器有效地将由单个操作系统管理的资源划分到孤立的组中，以更好地在孤立的组之间平衡有冲突的资源使用需求。<br>与传统虚拟化技术相比，它的优势在于：</p>
<ol>
<li>与宿主机使用同一个内核，性能损耗小；</li>
<li>不需要指令级模拟；</li>
<li>不需要即时(Just-in-time)编译；</li>
<li>容器可以在CPU核心的本地运行指令，不需要任何专门的解释机制；</li>
<li>避免了准虚拟化和系统调用替换中的复杂性；</li>
<li>轻量级隔离，在隔离的同时还提供共享机制，以实现容器与宿主机的资源共享。</li>
</ol>
<p>总结：Linux Container是一种轻量级的虚拟化的手段。</p>
<p>Linux Container提供了在单一可控主机节点上支持多个相互隔离的server container同时执行的机制。Linux Container有点像chroot，提供了一个拥有自己进程和网络空间的虚拟环境，但又有别于虚拟机，因为lxc是一种操作系统层次上的资源的虚拟化。</p>
<h3 id="LXC与docker什么关系？"><a href="#LXC与docker什么关系？" class="headerlink" title="LXC与docker什么关系？"></a>LXC与docker什么关系？</h3><p>docker并不是LXC替代品，docker底层使用了LXC来实现，LXC将linux进程沙盒化，使得进程之间相互隔离，并且能够控制各进程的资源分配。</p>
<p>在LXC的基础之上，docker提供了一系列更强大的功能。</p>
<h3 id="什么是docker"><a href="#什么是docker" class="headerlink" title="什么是docker"></a>什么是docker</h3><p>docker是一个开源的应用容器引擎，基于go语言开发并遵循了apache2.0协议开源。</p>
<p>docker可以让开发者打包他们的应用以及依赖包到一个轻量级、可移植的容器中，然后发布到任何流行的linux服务器，也可以实现虚拟化。</p>
<p>容器是完全使用沙箱机制，相互之间不会有任何接口（类iphone的app），并且容器开销极其低。</p>
<h3 id="为什么docker越来越受欢迎"><a href="#为什么docker越来越受欢迎" class="headerlink" title="为什么docker越来越受欢迎"></a>为什么docker越来越受欢迎</h3><p>容器化越来越受欢迎，因为容器是：</p>
<ul>
<li>灵活：即使是最复杂的应用也可以集装箱化。</li>
<li>轻量级：容器利用并共享主机内核。</li>
<li>可互换：您可以即时部署更新和升级。</li>
<li>便携式：您可以在本地构建，部署到云，并在任何地方运行。</li>
<li>可扩展：您可以增加并自动分发容器副本。</li>
<li>可堆叠：您可以垂直和即时堆叠服务。</li>
</ul>
<p>镜像和容器（contalners）</p>
<p>通过镜像启动一个容器，一个镜像是一个可执行的包，其中包括运行应用程序所需要的所有内容包含代码，运行时间，库、环境变量、和配置文件。</p>
<p>容器是镜像的运行实例，当被运行时有镜像状态和用户进程，可以使用docker ps 查看</p>
<p>容器和虚拟机</p>
<p>容器时在linux上本机运行，并与其他容器共享主机的内核，它运行的一个独立的进程，不占用其他任何可执行文件的内存，非常轻量</p>
<p>虚拟机运行的是一个完成的操作系统，通过虚拟机管理程序对主机资源进行虚拟访问，相比之下需要的资源更多</p>
<p><img src="https://ww1.sinaimg.cn/large/a3eed545ly1gog1ujsdmnj20k007qdi4.jpg" alt="容器和虚拟机架构图"></p>
<h3 id="docker版本"><a href="#docker版本" class="headerlink" title="docker版本"></a>docker版本</h3><ul>
<li>Docker Community Edition（CE）社区版</li>
<li>Enterprise Edition(EE) 商业版</li>
</ul>
<h3 id="docker和openstack的几项对比"><a href="#docker和openstack的几项对比" class="headerlink" title="docker和openstack的几项对比"></a>docker和openstack的几项对比</h3><table>
<thead>
<tr>
<th>类别</th>
<th>Docker</th>
<th>OpenStack</th>
</tr>
</thead>
<tbody>
<tr>
<td>部署难度</td>
<td>非常简单</td>
<td>组件多,部署复杂</td>
</tr>
<tr>
<td>启动速度</td>
<td>秒级</td>
<td>分钟级</td>
</tr>
<tr>
<td>执行性能</td>
<td>和物理系统几乎一致</td>
<td>vm会占用一些资源</td>
</tr>
<tr>
<td>镜像体积</td>
<td>镜像MB级别</td>
<td>虚拟机镜像GB级别</td>
</tr>
<tr>
<td>管理效率</td>
<td>管理简单</td>
<td>组件相互依赖,管理复杂</td>
</tr>
<tr>
<td>隔离性</td>
<td>隔离性搞</td>
<td>彻底隔离</td>
</tr>
<tr>
<td>可管理性</td>
<td>单进程</td>
<td>完整的系统管理</td>
</tr>
<tr>
<td>网络连接</td>
<td>比较弱</td>
<td>借助neutron可灵活组件各类网络管理</td>
</tr>
</tbody>
</table>
<h3 id="容器在内核中支持2种重要技术"><a href="#容器在内核中支持2种重要技术" class="headerlink" title="容器在内核中支持2种重要技术"></a>容器在内核中支持2种重要技术</h3><p>docker本质就是宿主机的一个进程，docker是通过namespace实现资源隔离，通过cgroup实现资源限制，通过写时复制技术（copy-on-write）实现了高效的文件操作（类似虚拟机的磁盘比如分配500g并不是实际占用物理磁盘500g）</p>
<p><strong>namespaces 名称空间</strong><br><img src="http://ww1.sinaimg.cn/large/a3eed545ly1gog215fvqmj20f2041wej.jpg" alt="namespaces 名称空间"></p>
<p><strong>Control Group 控制组</strong></p>
<p>cgroup的特点是：　　　　　　　</p>
<p>cgroup的api以一个伪文件系统的实现方式，用户的程序可以通过文件系统实现cgroup的组件管理</p>
<p>cgroup的组件管理操作单元可以细粒度到线程级别，另外用户可以创建和销毁cgroup，从而实现资源载分配和再利用</p>
<p>所有资源管理的功能都以子系统的方式实现，接口统一子任务创建之初与其父任务处于同一个cgroup的控制组</p>
<p><strong>四大功能</strong>：　　　　　　　　</p>
<ul>
<li>资源限制：可以对任务使用的资源总额进行限制</li>
<li>优先级分配：通过分配的cpu时间片数量以及磁盘IO带宽大小，实际上相当于控制了任务运行优先级</li>
<li>资源统计：可以统计系统的资源使用量，如cpu时长，内存用量等</li>
<li>任务控制：cgroup可以对任务执行挂起、恢复等操作</li>
</ul>
<h3 id="了解docker三个重要概念"><a href="#了解docker三个重要概念" class="headerlink" title="了解docker三个重要概念"></a>了解docker三个重要概念</h3><ol>
<li><p>image镜像</p>
<p> docker镜像就是一个只读模板，比如，一个镜像可以包含一个完整的centos，里面仅安装apache或用户的其他应用，镜像可以用来创建docker容器，另外docker提供了一个很简单的机制来创建镜像或者更新现有的镜像，用户甚至可以直接从其他人那里下周一个已经做好的镜像来直接使用</p>
</li>
<li><p>container容器</p>
<p> docker利用容器来运行应用，容器是从镜像创建的运行实例，它可以被启动，开始、停止、删除、每个容器都是互相隔离的，保证安全的平台，可以吧容器看做是要给简易版的linux环境（包括root用户权限、镜像空间、用户空间和网络空间等）和运行再其中的应用程序</p>
</li>
<li><p>repostory仓库</p>
<p> 仓库是集中存储镜像文件的沧桑，registry是仓库主从服务器，实际上参考注册服务器上存放着多个仓库，每个仓库中又包含了多个镜像，每个镜像有不同的标签（tag）</p>
</li>
</ol>
<p>仓库分为两种，公有参考，和私有仓库，最大的公开仓库是docker Hub，存放了数量庞大的镜像供用户下周，国内的docker pool，这里仓库的概念与Git类似，registry可以理解为github这样的托管服务</p>
<h3 id="docker的主要用途"><a href="#docker的主要用途" class="headerlink" title="docker的主要用途"></a>docker的主要用途</h3><p>官方就是Bulid 、ship、run any app/any where，编译、装载、运行、任何app/在任意地放都能运行</p>
<p>就是实现了应用的封装、部署、运行的生命周期管理只要在glibc的环境下，都可以运行</p>
<p>运维生成环境中：docker化</p>
<p>发布服务不用担心服务器的运行环境，所有的服务器都是自动分配docker，自动部署，自动安装，自动运行</p>
<p>再不用担心其他服务引擎的磁盘问题，cpu问题，系统问题了</p>
<p>资源利用更出色</p>
<p>自动迁移，可以制作镜像，迁移使用自定义的镜像即可迁移，不会出现什么问题</p>
<p>管理更加方便了</p>
<h3 id="docker改变了什么"><a href="#docker改变了什么" class="headerlink" title="docker改变了什么"></a>docker改变了什么</h3><ol>
<li>面向产品：产品交付</li>
<li>面向开发：简化环境配置</li>
<li>面向测试：多版本测试</li>
<li>面向运维：环境一致性</li>
<li>面向架构：自动化扩容（微服务）</li>
</ol>
<h2 id="docker架构"><a href="#docker架构" class="headerlink" title="docker架构"></a>docker架构</h2><h3 id="总体架构"><a href="#总体架构" class="headerlink" title="总体架构"></a>总体架构</h3><p><img src="https://ww1.sinaimg.cn/large/a3eed545ly1gog24dqkynj20nj0enmyo.jpg" alt="总体架构"></p>
<ul>
<li>distribution 负责与docker registry交互，上传洗澡镜像以及v2 registry 有关的源数据</li>
<li>registry负责docker registry有关的身份认证、镜像查找、镜像验证以及管理registry mirror等交互操作</li>
<li>image 负责与镜像源数据有关的存储、查找，镜像层的索引、查找以及镜像tar包有关的导入、导出操作</li>
<li>reference负责存储本地所有镜像的repository和tag名，并维护与镜像id之间的映射关系</li>
<li>layer模块负责与镜像层和容器层源数据有关的增删改查，并负责将镜像层的增删改查映射到实际存储镜像层文件的graphdriver模块</li>
<li>graghdriver是所有与容器镜像相关操作的执行者</li>
</ul>
<h3 id="docker架构1"><a href="#docker架构1" class="headerlink" title="docker架构1"></a>docker架构1</h3><p>如果觉得上面架构图比较乱可以看这个架构</p>
<p><img src="https://ww1.sinaimg.cn/large/a3eed545ly1gog257ec3lj20rk0y3440.jpg" alt="docker架构1"></p>
<p>从上图不难看出，用户是使用Docker Client与Docker Daemon建立通信，并发送请求给后者。</p>
<p>而Docker Daemon作为Docker架构中的主体部分，首先提供Server的功能使其可以接受Docker Client的请求；而后Engine执行Docker内部的一系列工作，每一项工作都是以一个Job的形式的存在。</p>
<p>Job的运行过程中，当需要容器镜像时，则从Docker Registry中下载镜像，并通过镜像管理驱动graphdriver将下载镜像以Graph的形式存储；当需要为Docker创建网络环境时，通过网络管理驱动networkdriver创建并配置Docker容器网络环境；当需要限制Docker容器运行资源或执行用户指令等操作时，则通过execdriver来完成。</p>
<p>而libcontainer是一项独立的容器管理包，networkdriver以及execdriver都是通过libcontainer来实现具体对容器进行的操作。当执行完运行容器的命令后，一个实际的Docker容器就处于运行状态，该容器拥有独立的文件系统，独立并且安全的运行环境等。</p>
<h3 id="docker架构2"><a href="#docker架构2" class="headerlink" title="docker架构2"></a>docker架构2</h3><p>再来看看另外一个架构，这个个架构就简单清晰指明了server/client交互，容器和镜像、数据之间的一些联系</p>
<p><img src="https://ww1.sinaimg.cn/large/a3eed545ly1gog25uxj7ij20j60b9q69.jpg" alt="docker架构2"></p>
<p>这个架构图更加清晰了架构</p>
<p>docker daemon就是docker的守护进程即server端，可以是远程的，也可以是本地的，这个不是C/S架构吗，客户端Docker client 是通过rest api进行通信</p>
<p>docker cli 用来管理容器和镜像，客户端提供一个只读镜像，然后通过镜像可以创建多个容器，这些容器可以只是一个RFS（Root file system根文件系统），也可以ishi一个包含了用户应用的RFS，容器再docker client中只是要给进程，两个进程之间互不可见</p>
<p>用户不能与server直接交互，但可以通过与容器这个桥梁来交互，由于是操作系统级别的虚拟技术，中间的损耗几乎可以不技</p>
<h2 id="docker架构2各个模块的功能"><a href="#docker架构2各个模块的功能" class="headerlink" title="docker架构2各个模块的功能"></a>docker架构2各个模块的功能</h2><p>主要的模块有:</p>
<ul>
<li>Docker Client</li>
<li>Docker Daemon</li>
<li>Docker Registry</li>
<li>Graph、Driver</li>
<li>Libcontainer</li>
<li>Docker container　</li>
</ul>
<ol>
<li><p>docker client</p>
<p> docker client 是docker架构中用户用来和docker daemon建立通信的客户端，用户使用的可执行文件为docker，通过docker命令行工具可以发起众多管理container的请求</p>
<p> docker client可以通过一下三宗方式和docker daemon建立通信：tcp://host:port;unix:path_to_socket;fd://socketfd。，docker client可以通过设置命令行flag参数的形式设置安全传输层协议(TLS)的有关参数，保证传输的安全性</p>
<p> docker client发送容器管理请求后，由docker daemon接受并处理请求，当docker client 接收到返回的请求相应并简单处理后，docker client 一次完整的生命周期就结束了，当需要继续发送容器管理请求时，用户必须再次通过docker可以执行文件创建docker client。</p>
</li>
<li><p>docker daemon</p>
<p> docker daemon 是docker架构中一个常驻在后台的系统进程，功能是：接收处理docker client发送的请求。该守护进程在后台启动一个server，server负载接受docker client发送的请求；接受请求后，server通过路由与分发调度，找到相应的handler来执行请求。</p>
<p> docker daemon启动所使用的可执行文件也为docker，与docker client启动所使用的可执行文件docker相同，在docker命令执行时，通过传入的参数来判别docker daemon与docker client。</p>
<p> docker daemon的架构可以分为：docker server、engine、job。daemon</p>
</li>
<li><p>docker server</p>
<p> docker server在docker架构中时专门服务于docker client的server，该server的功能时：接受并调度分发docker client发送的请求，架构图如下：</p>
<p> <img src="https://ww1.sinaimg.cn/large/a3eed545ly1gog2etjt6qj20hd0d23zv.jpg" alt="docker client"></p>
<p> 在Docker的启动过程中，通过包gorilla/mux（golang的类库解析），创建了一个mux.Router，提供请求的路由功能。在Golang中，gorilla/mux是一个强大的URL路由器以及调度分发器。该mux.Router中添加了众多的路由项，每一个路由项由HTTP请求方法（PUT、POST、GET或DELETE）、URL、Handler三部分组成。</p>
<p> 若Docker Client通过HTTP的形式访问Docker Daemon，创建完mux.Router之后，Docker将Server的监听地址以及mux.Router作为参数，创建一个httpSrv=http.Server{}，最终执行httpSrv.Serve()为请求服务。</p>
<p> 在Server的服务过程中，Server在listener上接受Docker Client的访问请求，并创建一个全新的goroutine来服务该请求。在goroutine中，首先读取请求内容，然后做解析工作，接着找到相应的路由项，随后调用相应的Handler来处理该请求，最后Handler处理完请求之后回复该请求。</p>
<p> 需要注意的是：Docker Server的运行在Docker的启动过程中，是靠一个名为”serveapi”的job的运行来完成的。原则上，Docker Server的运行是众多job中的一个，但是为了强调Docker Server的重要性以及为后续job服务的重要特性，将该”serveapi”的job单独抽离出来分析，理解为Docker Server。</p>
</li>
<li><p>engine</p>
<p> Engine是Docker架构中的运行引擎，同时也Docker运行的核心模块。它扮演Docker container存储仓库的角色，并且通过执行job的方式来操纵管理这些容器。</p>
<p> 在Engine数据结构的设计与实现过程中，有一个handler对象。该handler对象存储的都是关于众多特定job的handler处理访问。举例说明，Engine的handler对象中有一项为：{“create”: daemon.ContainerCreate,}，则说明当名为”create”的job在运行时，执行的是daemon.ContainerCreate的handler。</p>
</li>
<li><p>job</p>
<p> 一个Job可以认为是Docker架构中Engine内部最基本的工作执行单元。Docker可以做的每一项工作，都可以抽象为一个job。例如：在容器内部运行一个进程，这是一个job；创建一个新的容器，这是一个job，从Internet上下载一个文档，这是一个job；包括之前在Docker Server部分说过的，创建Server服务于HTTP的API，这也是一个job，等等。</p>
<p> Job的设计者，把Job设计得与Unix进程相仿。比如说：Job有一个名称，有参数，有环境变量，有标准的输入输出，有错误处理，有返回状态等。</p>
</li>
<li><p>docker registry</p>
<p> Docker Registry是一个存储容器镜像的仓库。而容器镜像是在容器被创建时，被加载用来初始化容器的文件架构与目录。</p>
<p> 在Docker的运行过程中，Docker Daemon会与Docker Registry通信，并实现搜索镜像、下载镜像、上传镜像三个功能，这三个功能对应的job名称分别为”search”，”pull” 与 “push”。</p>
<p> 其中，在Docker架构中，Docker可以使用公有的Docker Registry，即大家熟知的Docker Hub，如此一来，Docker获取容器镜像文件时，必须通过互联网访问Docker Hub；同时Docker也允许用户构建本地私有的Docker Registry，这样可以保证容器镜像的获取在内网完成。</p>
</li>
<li><p>Graph</p>
<p> Graph在Docker架构中扮演已下载容器镜像的保管者，以及已下载容器镜像之间关系的记录者。一方面，Graph存储着本地具有版本信息的文件系统镜像，另一方面也通过GraphDB记录着所有文件系统镜像彼此之间的关系。Graph的架构如下：<br> <img src="https://ww1.sinaimg.cn/large/a3eed545ly1gog2ikt3usj20l10avabx.jpg" alt="Graph架构图"></p>
<p> 其中，GraphDB是一个构建在SQLite之上的小型图数据库，实现了节点的命名以及节点之间关联关系的记录。它仅仅实现了大多数图数据库所拥有的一个小的子集，但是提供了简单的接口表示节点之间的关系。</p>
<p> 同时在Graph的本地目录中，关于每一个的容器镜像，具体存储的信息有：该容器镜像的元数据，容器镜像的大小信息，以及该容器镜像所代表的具体rootfs。</p>
</li>
<li><p>driver</p>
<p> Driver是Docker架构中的驱动模块。通过Driver驱动，Docker可以实现对Docker容器执行环境的定制。由于Docker运行的生命周期中，并非用户所有的操作都是针对Docker容器的管理，另外还有关于Docker运行信息的获取，Graph的存储与记录等。因此，为了将Docker容器的管理从Docker Daemon内部业务逻辑中区分开来，设计了Driver层驱动来接管所有这部分请求。</p>
<p> 在Docker Driver的实现中，可以分为以下三类驱动：graphdriver、networkdriver和execdriver。</p>
<p> graphdriver主要用于完成容器镜像的管理，包括存储与获取。即当用户需要下载指定的容器镜像时，graphdriver将容器镜像存储在本地的指定目录；同时当用户需要使用指定的容器镜像来创建容器的rootfs时，graphdriver从本地镜像存储目录中获取指定的容器镜像。</p>
<p> 在graphdriver的初始化过程之前，有4种文件系统或类文件系统在其内部注册，它们分别是aufs、btrfs、vfs和devmapper。而Docker在初始化之时，通过获取系统环境变量”DOCKER_DRIVER”来提取所使用driver的指定类型。而之后所有的graph操作，都使用该driver来执行。</p>
<p> graphdriver的架构如下：<br> <img src="https://ww1.sinaimg.cn/large/a3eed545ly1gog2n8l0pfj20fj095gm6.jpg" alt="graphdriver架构图"><br> networkdriver的用途是完成Docker容器网络环境的配置，其中包括Docker启动时为Docker环境创建网桥；Docker容器创建时为其创建专属虚拟网卡设备；以及为Docker容器分配IP、端口并与宿主机做端口映射，设置容器防火墙策略等。networkdriver的架构如下：<br> <img src="https://ww1.sinaimg.cn/large/a3eed545ly1gog2nuwt2tj20gh0av3ze.jpg" alt="networkdriver架构图"><br> execdriver作为Docker容器的执行驱动，负责创建容器运行命名空间，负责容器资源使用的统计与限制，负责容器内部进程的真正运行等。在execdriver的实现过程中，原先可以使用LXC驱动调用LXC的接口，来操纵容器的配置以及生命周期，而现在execdriver默认使用native驱动，不依赖于LXC。具体体现在Daemon启动过程中加载的ExecDriverflag参数，该参数在配置文件已经被设为”native”。这可以认为是Docker在1.2版本上一个很大的改变，或者说Docker实现跨平台的一个先兆。execdriver架构如下：<br> <img src="https://ww1.sinaimg.cn/large/a3eed545ly1gog2tu7hkij20fd09cjry.jpg" alt="execdriver架构图"></p>
</li>
<li><p>libcontainer</p>
<p> libcontainer是Docker架构中一个使用Go语言设计实现的库，设计初衷是希望该库可以不依靠任何依赖，直接访问内核中与容器相关的API。</p>
<p> 正是由于libcontainer的存在，Docker可以直接调用libcontainer，而最终操纵容器的namespace、cgroups、apparmor、网络设备以及防火墙规则等。这一系列操作的完成都不需要依赖LXC或者其他包。libcontainer架构如下：<br> <img src="https://ww1.sinaimg.cn/large/a3eed545ly1gog2vdwboqj20h0096wf5.jpg" alt="libcontainer架构图"></p>
<p> 另外，libcontainer提供了一整套标准的接口来满足上层对容器管理的需求。或者说，libcontainer屏蔽了Docker上层对容器的直接管理。又由于libcontainer使用Go这种跨平台的语言开发实现，且本身又可以被上层多种不同的编程语言访问，因此很难说，未来的Docker就一定会紧紧地和Linux捆绑在一起。而于此同时，Microsoft在其著名云计算平台Azure中，也添加了对Docker的支持，可见Docker的开放程度与业界的火热度。</p>
<p> 暂不谈Docker，由于libcontainer的功能以及其本身与系统的松耦合特性，很有可能会在其他以容器为原型的平台出现，同时也很有可能催生出云计算领域全新的项目。</p>
</li>
<li><p>docker container</p>
<p>Docker container（Docker容器）是Docker架构中服务交付的最终体现形式。</p>
<p>Docker按照用户的需求与指令，订制相应的Docker容器：</p>
<p>用户通过指定容器镜像，使得Docker容器可以自定义rootfs等文件系统； 用户通过指定计算资源的配额，使得Docker容器使用指定的计算资源； 用户通过配置网络及其安全策略，使得Docker容器拥有独立且安全的网络环境； 用户通过指定运行的命令，使得Docker容器执行指定的工作。<br><img src="https://ww1.sinaimg.cn/large/a3eed545ly1gog2wfz9oxj20ln0cjgmg.jpg" alt="docker container"></p>
</li>
</ol>
<h2 id="docker简单使用"><a href="#docker简单使用" class="headerlink" title="docker简单使用"></a>docker简单使用</h2><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>官方安装文档:<a target="_blank" rel="noopener" href="https://docs.docker.com/engine/install/">https://docs.docker.com/engine/install/</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">yum install docker -y </span><br><span class="line"></span><br><span class="line">systemctl enable docker</span><br><span class="line"></span><br><span class="line">systemctl start docker</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>注意：启动前应当设置源</p>
<p><code>vim /usr/lib/systemd/system/docker.service</code></p>
<p>这里设置阿里的，注册阿里云账户号每个用户都有</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">[root@web1 ~]# vim /usr/lib/systemd/system/docker.service </span><br><span class="line"></span><br><span class="line">[Unit]</span><br><span class="line">Description=Docker Application Container Engine</span><br><span class="line">Documentation=http://docs.docker.com</span><br><span class="line">After=network.target</span><br><span class="line">Wants=docker-storage-setup.service</span><br><span class="line">Requires=docker-cleanup.timer</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=notify</span><br><span class="line">NotifyAccess=main</span><br><span class="line">EnvironmentFile=-/run/containers/registries.conf</span><br><span class="line">EnvironmentFile=-/etc/sysconfig/docker</span><br><span class="line">EnvironmentFile=-/etc/sysconfig/docker-storage</span><br><span class="line">EnvironmentFile=-/etc/sysconfig/docker-network</span><br><span class="line">Environment=GOTRACEBACK=crash</span><br><span class="line">Environment=DOCKER_HTTP_HOST_COMPAT=1</span><br><span class="line">Environment=PATH=/usr/libexec/docker:/usr/bin:/usr/sbin</span><br><span class="line">ExecStart=/usr/bin/dockerd-current --registry-mirror=https://rfcod7oz.mirror.aliyuncs.com \ #这个值可以登陆阿里云账号请参考下图</span><br><span class="line">          --add-runtime docker-runc=/usr/libexec/docker/docker-runc-current \</span><br><span class="line">          --default-runtime=docker-runc \</span><br><span class="line">          --exec-opt native.cgroupdriver=systemd \</span><br><span class="line">          --userland-proxy-path=/usr/libexec/docker/docker-proxy-current \</span><br><span class="line">          --init-path=/usr/libexec/docker/docker-init-current \</span><br><span class="line">          --seccomp-profile=/etc/docker/seccomp.json \</span><br><span class="line">          $OPTIONS \</span><br><span class="line">          $DOCKER_STORAGE_OPTIONS \</span><br><span class="line">          $DOCKER_NETWORK_OPTIONS \</span><br><span class="line">          $ADD_REGISTRY \</span><br><span class="line">          $BLOCK_REGISTRY \</span><br><span class="line">          $INSECURE_REGISTRY \</span><br><span class="line">          $REGISTRIES</span><br><span class="line">ExecReload=/bin/kill -s HUP $MAINPID</span><br><span class="line">LimitNOFILE=1048576</span><br><span class="line">LimitNPROC=1048576</span><br><span class="line">LimitCORE=infinity</span><br><span class="line">TimeoutStartSec=0</span><br><span class="line">Restart=on-abnormal</span><br><span class="line">KillMode=process</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>
<p><img src="https://ww1.sinaimg.cn/large/a3eed545ly1gog32lik13j20ql0gedla.jpg" alt="阿里云界面图"></p>
<h3 id="docker版本查询"><a href="#docker版本查询" class="headerlink" title="docker版本查询"></a>docker版本查询</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[root@local ~]# docker version</span><br><span class="line">Client: Docker Engine - Community</span><br><span class="line"> Version:           20.10.5</span><br><span class="line"> API version:       1.41</span><br><span class="line"> Go version:        go1.13.15</span><br><span class="line"> Git commit:        55c4c88</span><br><span class="line"> Built:             Tue Mar  2 20:33:55 2021</span><br><span class="line"> OS/Arch:           linux/amd64</span><br><span class="line"> Context:           default</span><br><span class="line"> Experimental:      true</span><br><span class="line"></span><br><span class="line">Server: Docker Engine - Community</span><br><span class="line"> Engine:</span><br><span class="line">  Version:          20.10.5</span><br><span class="line">  API version:      1.41 (minimum version 1.12)</span><br><span class="line">  Go version:       go1.13.15</span><br><span class="line">  Git commit:       363e9a8</span><br><span class="line">  Built:            Tue Mar  2 20:32:17 2021</span><br><span class="line">  OS/Arch:          linux/amd64</span><br><span class="line">  Experimental:     false</span><br><span class="line"> containerd:</span><br><span class="line">  Version:          1.4.3</span><br><span class="line">  GitCommit:        269548fa27e0089a8b8278fc4fc781d7f65a939b</span><br><span class="line"> runc:</span><br><span class="line">  Version:          1.0.0-rc92</span><br><span class="line">  GitCommit:        ff819c7e9184c13b7c2607fe6c30ae19403a7aff</span><br><span class="line"> docker-init:</span><br><span class="line">  Version:          0.19.0</span><br><span class="line">  GitCommit:        de40ad0</span><br><span class="line">[root@local ~]# </span><br></pre></td></tr></table></figure>
<h3 id="搜索下载镜像"><a href="#搜索下载镜像" class="headerlink" title="搜索下载镜像"></a>搜索下载镜像</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker pull redis　　　　　　　　　　#下载镜像</span><br><span class="line">docker search mysql　　　　　　　　　 #查看镜像</span><br><span class="line">docker pull mysql</span><br></pre></td></tr></table></figure>
<h3 id="查看已经下载的镜像"><a href="#查看已经下载的镜像" class="headerlink" title="查看已经下载的镜像"></a>查看已经下载的镜像</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@local ~]# docker images</span><br><span class="line">REPOSITORY   TAG       IMAGE ID       CREATED       SIZE</span><br><span class="line">redis        latest    f877e80bb9ef   8 days ago    105MB</span><br><span class="line">mysql        5.7.33    d54bd1054823   12 days ago   449MB</span><br></pre></td></tr></table></figure>
<h3 id="导出镜像"><a href="#导出镜像" class="headerlink" title="导出镜像"></a>导出镜像</h3><p><code>docker  save nginx &gt;/tmp/nginx.tar.gz</code></p>
<h3 id="删除镜像"><a href="#删除镜像" class="headerlink" title="删除镜像"></a>删除镜像</h3><p><code>docker rmi -f nginx</code></p>
<h3 id="导入镜像"><a href="#导入镜像" class="headerlink" title="导入镜像"></a>导入镜像</h3><p><code>docker load &lt;/tmp/nginx.tar.gz</code></p>
<h3 id="默认配置文件"><a href="#默认配置文件" class="headerlink" title="默认配置文件"></a>默认配置文件</h3><p><code>vim /usr/lib/systemd/system/docker.service</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=Docker Application Container Engine</span><br><span class="line">Documentation=https://docs.docker.com</span><br><span class="line">After=network-online.target firewalld.service containerd.service</span><br><span class="line">Wants=network-online.target</span><br><span class="line">Requires=docker.socket containerd.service</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=notify</span><br><span class="line"># the default is not to use systemd for cgroups because the delegate issues still</span><br><span class="line"># exists and systemd currently does not support the cgroup feature set required</span><br><span class="line"># for containers run by docker</span><br><span class="line">ExecStart=/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock</span><br><span class="line">ExecReload=/bin/kill -s HUP $MAINPID</span><br><span class="line">TimeoutSec=0</span><br><span class="line">RestartSec=2</span><br><span class="line">Restart=always</span><br><span class="line"></span><br><span class="line"># Note that StartLimit* options were moved from &quot;Service&quot; to &quot;Unit&quot; in systemd 229.</span><br><span class="line"># Both the old, and new location are accepted by systemd 229 and up, so using the old location</span><br><span class="line"># to make them work for either version of systemd.</span><br><span class="line">StartLimitBurst=3</span><br><span class="line"></span><br><span class="line"># Note that StartLimitInterval was renamed to StartLimitIntervalSec in systemd 230.</span><br><span class="line"># Both the old, and new name are accepted by systemd 230 and up, so using the old name to make</span><br><span class="line"># this option work for either version of systemd.</span><br><span class="line">StartLimitInterval=60s</span><br><span class="line"></span><br><span class="line"># Having non-zero Limit*s causes performance problems due to accounting overhead</span><br><span class="line"># in the kernel. We recommend using cgroups to do container-local accounting.</span><br><span class="line">LimitNOFILE=infinity</span><br><span class="line">LimitNPROC=infinity</span><br><span class="line">LimitCORE=infinity</span><br><span class="line"></span><br><span class="line"># Comment TasksMax if your systemd version does not support it.</span><br><span class="line"># Only systemd 226 and above support this option.</span><br><span class="line">TasksMax=infinity</span><br><span class="line"></span><br><span class="line"># set delegate yes so that systemd does not reset the cgroups of docker containers</span><br><span class="line">Delegate=yes</span><br><span class="line"></span><br><span class="line"># kill only the docker process, not all processes in the cgroup</span><br><span class="line">KillMode=process</span><br><span class="line">OOMScoreAdjust=-500</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line">~  </span><br></pre></td></tr></table></figure>
<p>如果更改存储目录就添加</p>
<p><code>--graph=/opt/docker</code></p>
<p>如果更改DNS</p>
<p>默认采用宿主机的dns</p>
<p><code>--dns=xxxx的方式指定</code></p>
<h3 id="运行一个容器-run"><a href="#运行一个容器-run" class="headerlink" title="运行一个容器-run"></a>运行一个容器-run</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@local ~]# docker run -it redis sh   </span><br><span class="line"># cd ..</span><br><span class="line"># ls</span><br><span class="line">bin  boot  data  dev  etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br><span class="line"># exit</span><br><span class="line">[root@local ~]# </span><br></pre></td></tr></table></figure>
<p>后台运行（-d后台运行）（–name添加一个名字）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@local ~]# docker run -it -d --name redis1 redis</span><br><span class="line">57c2f2e3f550caa022be4c1a1065d33d833580b6d4141beca138d82a9efd866e</span><br><span class="line">[root@local ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE          COMMAND                  CREATED          STATUS          PORTS                 NAMES</span><br><span class="line">57c2f2e3f550   redis          &quot;docker-entrypoint.s…&quot;   12 seconds ago   Up 12 seconds   6379/tcp              redis1</span><br><span class="line">fa6d604f34b0   mysql:5.7.33   &quot;docker-entrypoint.s…&quot;   6 days ago       Up 6 days       3306/tcp, 33060/tcp   mysql5.7</span><br><span class="line">f1035f25b549   redis          &quot;docker-entrypoint.s…&quot;   6 days ago       Up 6 days       6379/tcp              redis</span><br><span class="line">[root@local ~]# </span><br></pre></td></tr></table></figure>
<p>还有一种-rm参数，ctrl+c后就删除，可以测试环境用，生成环境用的少</p>
<p><code>docker run -it  --rm --name redis2 redis</code></p>
<h3 id="如何进入容器"><a href="#如何进入容器" class="headerlink" title="如何进入容器"></a>如何进入容器</h3><p>三种方法，上面已经演示了一种</p>
<p>第一种，需要容器本身的pid及util-linux，不推荐，暂时不演示了</p>
<p>第二种，不分配bash终端的一种实施操作，不推荐</p>
<p>这种操作如果在开一个窗口也能看到操作的指令，所有人都能看到<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@local ~]# docker attach redis</span><br><span class="line">ls</span><br><span class="line">ls</span><br><span class="line">^C1:signal-handler (1615455437) Received SIGINT scheduling shutdown...</span><br><span class="line">1:M 11 Mar 2021 09:37:17.600 # User requested shutdown...</span><br><span class="line">1:M 11 Mar 2021 09:37:17.600 * Saving the final RDB snapshot before exiting.</span><br><span class="line">1:M 11 Mar 2021 09:37:17.601 * DB saved on disk</span><br><span class="line">1:M 11 Mar 2021 09:37:17.601 # Redis is now ready to exit, bye bye...</span><br><span class="line">[root@local ~]# ^C</span><br><span class="line">[root@local ~]# docker attach redis</span><br><span class="line">You cannot attach to a stopped container, start it first</span><br><span class="line">[root@local ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE          COMMAND                  CREATED      STATUS      PORTS                 NAMES</span><br><span class="line">fa6d604f34b0   mysql:5.7.33   &quot;docker-entrypoint.s…&quot;   6 days ago   Up 6 days   3306/tcp, 33060/tcp   mysql5.7</span><br></pre></td></tr></table></figure></p>
<p>第三种：exec方式，终端时分开的，推荐</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@local ~]# docker run -it -d --name redis1 redis</span><br><span class="line">cf0cf2d3eff2f5a8da0016efe077dd5c91d25fdd09ec39b2ecd521f5b6bff74c</span><br><span class="line">[root@local ~]# docker exec -it redis1 sh </span><br><span class="line"># ls</span><br><span class="line"># cd ..</span><br><span class="line"># ls</span><br><span class="line">bin  boot  data  dev  etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br><span class="line"># exit</span><br><span class="line">[root@local ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE          COMMAND                  CREATED         STATUS         PORTS                 NAMES</span><br><span class="line">cf0cf2d3eff2   redis          &quot;docker-entrypoint.s…&quot;   6 minutes ago   Up 6 minutes   6379/tcp              redis1</span><br><span class="line">fa6d604f34b0   mysql:5.7.33   &quot;docker-entrypoint.s…&quot;   6 days ago      Up 6 days      3306/tcp, 33060/tcp   mysql5.7</span><br><span class="line">[root@local ~]# </span><br></pre></td></tr></table></figure>
<h3 id="查看docker进程及删除容器"><a href="#查看docker进程及删除容器" class="headerlink" title="查看docker进程及删除容器"></a>查看docker进程及删除容器</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@local ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE          COMMAND                  CREATED         STATUS         PORTS                 NAMES</span><br><span class="line">cf0cf2d3eff2   redis          &quot;docker-entrypoint.s…&quot;   6 minutes ago   Up 6 minutes   6379/tcp              redis1</span><br><span class="line">fa6d604f34b0   mysql:5.7.33   &quot;docker-entrypoint.s…&quot;   6 days ago      Up 6 days      3306/tcp, 33060/tcp   mysql5.7</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@local ~]# docker ps -a </span><br><span class="line">CONTAINER ID   IMAGE          COMMAND                  CREATED          STATUS                      PORTS                 NAMES</span><br><span class="line">cf0cf2d3eff2   redis          &quot;docker-entrypoint.s…&quot;   9 minutes ago    Up 9 minutes                6379/tcp              redis1</span><br><span class="line">5ee132daeb4c   redis          &quot;docker-entrypoint.s…&quot;   20 minutes ago   Exited (0) 20 minutes ago                         stupefied_chatelet</span><br><span class="line">dc7f8b8d2e75   redis          &quot;docker-entrypoint.s…&quot;   21 minutes ago   Exited (0) 20 minutes ago                         exciting_moore</span><br><span class="line">ca35b108e1fd   redis          &quot;docker-entrypoint.s…&quot;   38 minutes ago   Exited (0) 37 minutes ago                         dazzling_wilbur</span><br><span class="line">7b634fd0ed15   redis          &quot;docker-entrypoint.s…&quot;   38 minutes ago   Exited (0) 38 minutes ago                         nostalgic_feistel</span><br><span class="line">fa6d604f34b0   mysql:5.7.33   &quot;docker-entrypoint.s…&quot;   6 days ago       Up 6 days                   3306/tcp, 33060/tcp   mysql5.7</span><br><span class="line">f1035f25b549   redis          &quot;docker-entrypoint.s…&quot;   6 days ago       Exited (0) 25 minutes ago                         redis</span><br></pre></td></tr></table></figure>
<h3 id="查看容器详细信息"><a href="#查看容器详细信息" class="headerlink" title="查看容器详细信息"></a>查看容器详细信息</h3><p>并不需要进入到容器里面</p>
<p>通过查看详细信息看到了刚才运行的nginx，宿主机curl ip地址访问一下运行情况</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br></pre></td><td class="code"><pre><span class="line">[root@local ~]# docker inspect redis1</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Id&quot;: &quot;cf0cf2d3eff2f5a8da0016efe077dd5c91d25fdd09ec39b2ecd521f5b6bff74c&quot;,</span><br><span class="line">        &quot;Created&quot;: &quot;2021-03-11T09:52:25.27057006Z&quot;,</span><br><span class="line">        &quot;Path&quot;: &quot;docker-entrypoint.sh&quot;,</span><br><span class="line">        &quot;Args&quot;: [</span><br><span class="line">            &quot;redis-server&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;State&quot;: &#123;</span><br><span class="line">            &quot;Status&quot;: &quot;running&quot;,</span><br><span class="line">            &quot;Running&quot;: true,</span><br><span class="line">            &quot;Paused&quot;: false,</span><br><span class="line">            &quot;Restarting&quot;: false,</span><br><span class="line">            &quot;OOMKilled&quot;: false,</span><br><span class="line">            &quot;Dead&quot;: false,</span><br><span class="line">            &quot;Pid&quot;: 14094,</span><br><span class="line">            &quot;ExitCode&quot;: 0,</span><br><span class="line">            &quot;Error&quot;: &quot;&quot;,</span><br><span class="line">            &quot;StartedAt&quot;: &quot;2021-03-11T09:52:25.557173161Z&quot;,</span><br><span class="line">            &quot;FinishedAt&quot;: &quot;0001-01-01T00:00:00Z&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Image&quot;: &quot;sha256:f877e80bb9ef719f7d6e7faa3cde7e20b97dc6d774d46175adcc8442ec7236aa&quot;,</span><br><span class="line">        &quot;ResolvConfPath&quot;: &quot;/var/lib/docker/containers/cf0cf2d3eff2f5a8da0016efe077dd5c91d25fdd09ec39b2ecd521f5b6bff74c/resolv.conf&quot;,</span><br><span class="line">        &quot;HostnamePath&quot;: &quot;/var/lib/docker/containers/cf0cf2d3eff2f5a8da0016efe077dd5c91d25fdd09ec39b2ecd521f5b6bff74c/hostname&quot;,</span><br><span class="line">        &quot;HostsPath&quot;: &quot;/var/lib/docker/containers/cf0cf2d3eff2f5a8da0016efe077dd5c91d25fdd09ec39b2ecd521f5b6bff74c/hosts&quot;,</span><br><span class="line">        &quot;LogPath&quot;: &quot;/var/lib/docker/containers/cf0cf2d3eff2f5a8da0016efe077dd5c91d25fdd09ec39b2ecd521f5b6bff74c/cf0cf2d3eff2f5a8da0016efe077dd5c91d25fdd09ec39b2ecd521f5b6bff74c-json.log&quot;,</span><br><span class="line">        &quot;Name&quot;: &quot;/redis1&quot;,</span><br><span class="line">        &quot;RestartCount&quot;: 0,</span><br><span class="line">        &quot;Driver&quot;: &quot;overlay2&quot;,</span><br><span class="line">        &quot;Platform&quot;: &quot;linux&quot;,</span><br><span class="line">        &quot;MountLabel&quot;: &quot;&quot;,</span><br><span class="line">        &quot;ProcessLabel&quot;: &quot;&quot;,</span><br><span class="line">        &quot;AppArmorProfile&quot;: &quot;&quot;,</span><br><span class="line">        &quot;ExecIDs&quot;: null,</span><br><span class="line">        &quot;HostConfig&quot;: &#123;</span><br><span class="line">            &quot;Binds&quot;: null,</span><br><span class="line">            &quot;ContainerIDFile&quot;: &quot;&quot;,</span><br><span class="line">            &quot;LogConfig&quot;: &#123;</span><br><span class="line">                &quot;Type&quot;: &quot;json-file&quot;,</span><br><span class="line">                &quot;Config&quot;: &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;NetworkMode&quot;: &quot;default&quot;,</span><br><span class="line">            &quot;PortBindings&quot;: &#123;&#125;,</span><br><span class="line">            &quot;RestartPolicy&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;no&quot;,</span><br><span class="line">                &quot;MaximumRetryCount&quot;: 0</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;AutoRemove&quot;: false,</span><br><span class="line">            &quot;VolumeDriver&quot;: &quot;&quot;,</span><br><span class="line">            &quot;VolumesFrom&quot;: null,</span><br><span class="line">            &quot;CapAdd&quot;: null,</span><br><span class="line">            &quot;CapDrop&quot;: null,</span><br><span class="line">            &quot;CgroupnsMode&quot;: &quot;host&quot;,</span><br><span class="line">            &quot;Dns&quot;: [],</span><br><span class="line">            &quot;DnsOptions&quot;: [],</span><br><span class="line">            &quot;DnsSearch&quot;: [],</span><br><span class="line">            &quot;ExtraHosts&quot;: null,</span><br><span class="line">            &quot;GroupAdd&quot;: null,</span><br><span class="line">            &quot;IpcMode&quot;: &quot;private&quot;,</span><br><span class="line">            &quot;Cgroup&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Links&quot;: null,</span><br><span class="line">            &quot;OomScoreAdj&quot;: 0,</span><br><span class="line">            &quot;PidMode&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Privileged&quot;: false,</span><br><span class="line">            &quot;PublishAllPorts&quot;: false,</span><br><span class="line">            &quot;ReadonlyRootfs&quot;: false,</span><br><span class="line">            &quot;SecurityOpt&quot;: null,</span><br><span class="line">            &quot;UTSMode&quot;: &quot;&quot;,</span><br><span class="line">            &quot;UsernsMode&quot;: &quot;&quot;,</span><br><span class="line">            &quot;ShmSize&quot;: 67108864,</span><br><span class="line">            &quot;Runtime&quot;: &quot;runc&quot;,</span><br><span class="line">            &quot;ConsoleSize&quot;: [</span><br><span class="line">                0,</span><br><span class="line">                0</span><br><span class="line">            ],</span><br><span class="line">            &quot;Isolation&quot;: &quot;&quot;,</span><br><span class="line">            &quot;CpuShares&quot;: 0,</span><br><span class="line">            &quot;Memory&quot;: 0,</span><br><span class="line">            &quot;NanoCpus&quot;: 0,</span><br><span class="line">            &quot;CgroupParent&quot;: &quot;&quot;,</span><br><span class="line">            &quot;BlkioWeight&quot;: 0,</span><br><span class="line">            &quot;BlkioWeightDevice&quot;: [],</span><br><span class="line">            &quot;BlkioDeviceReadBps&quot;: null,</span><br><span class="line">            &quot;BlkioDeviceWriteBps&quot;: null,</span><br><span class="line">            &quot;BlkioDeviceReadIOps&quot;: null,</span><br><span class="line">            &quot;BlkioDeviceWriteIOps&quot;: null,</span><br><span class="line">            &quot;CpuPeriod&quot;: 0,</span><br><span class="line">            &quot;CpuQuota&quot;: 0,</span><br><span class="line">            &quot;CpuRealtimePeriod&quot;: 0,</span><br><span class="line">            &quot;CpuRealtimeRuntime&quot;: 0,</span><br><span class="line">            &quot;CpusetCpus&quot;: &quot;&quot;,</span><br><span class="line">            &quot;CpusetMems&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Devices&quot;: [],</span><br><span class="line">            &quot;DeviceCgroupRules&quot;: null,</span><br><span class="line">            &quot;DeviceRequests&quot;: null,</span><br><span class="line">            &quot;KernelMemory&quot;: 0,</span><br><span class="line">            &quot;KernelMemoryTCP&quot;: 0,</span><br><span class="line">            &quot;MemoryReservation&quot;: 0,</span><br><span class="line">            &quot;MemorySwap&quot;: 0,</span><br><span class="line">            &quot;MemorySwappiness&quot;: null,</span><br><span class="line">            &quot;OomKillDisable&quot;: false,</span><br><span class="line">            &quot;PidsLimit&quot;: null,</span><br><span class="line">            &quot;Ulimits&quot;: null,</span><br><span class="line">            &quot;CpuCount&quot;: 0,</span><br><span class="line">            &quot;CpuPercent&quot;: 0,</span><br><span class="line">            &quot;IOMaximumIOps&quot;: 0,</span><br><span class="line">            &quot;IOMaximumBandwidth&quot;: 0,</span><br><span class="line">            &quot;MaskedPaths&quot;: [</span><br><span class="line">                &quot;/proc/asound&quot;,</span><br><span class="line">                &quot;/proc/acpi&quot;,</span><br><span class="line">                &quot;/proc/kcore&quot;,</span><br><span class="line">                &quot;/proc/keys&quot;,</span><br><span class="line">                &quot;/proc/latency_stats&quot;,</span><br><span class="line">                &quot;/proc/timer_list&quot;,</span><br><span class="line">                &quot;/proc/timer_stats&quot;,</span><br><span class="line">                &quot;/proc/sched_debug&quot;,</span><br><span class="line">                &quot;/proc/scsi&quot;,</span><br><span class="line">                &quot;/sys/firmware&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;ReadonlyPaths&quot;: [</span><br><span class="line">                &quot;/proc/bus&quot;,</span><br><span class="line">                &quot;/proc/fs&quot;,</span><br><span class="line">                &quot;/proc/irq&quot;,</span><br><span class="line">                &quot;/proc/sys&quot;,</span><br><span class="line">                &quot;/proc/sysrq-trigger&quot;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;GraphDriver&quot;: &#123;</span><br><span class="line">            &quot;Data&quot;: &#123;</span><br><span class="line">                &quot;LowerDir&quot;: &quot;/var/lib/docker/overlay2/b0e04902fbfbca7b31445142b80d8b81910b7d47349eddc3b79f0ac3550baf88-init/diff:/var/lib/docker/overlay2/c8195a6dbb57677eae47daed1ed16f166301a6030ce90aca170f42705427b7b4/diff:/var/lib/docker/overlay2/c9538592b84c294ce9e2511296f4b74f8ebd48e8c197c66314a3b9caa6d81b80/diff:/var/lib/docker/overlay2/af1a27fcf6f367b3eee0dc7159ae8d000ebe9593ebb2e1daa38427e27c91e9fc/diff:/var/lib/docker/overlay2/1ac7b88145453c7ecd0a01b0bcebabb9733c2a1c61b611f0b3d72261450ff840/diff:/var/lib/docker/overlay2/88bc5c0a0d044d790d6575ef77ed0be038c9bef8fb6c3e9a43b3642e8eeeea60/diff:/var/lib/docker/overlay2/c38c6c85d32a3d8c20db57707f96551848a5b19373588b12964681153c241a57/diff&quot;,</span><br><span class="line">                &quot;MergedDir&quot;: &quot;/var/lib/docker/overlay2/b0e04902fbfbca7b31445142b80d8b81910b7d47349eddc3b79f0ac3550baf88/merged&quot;,</span><br><span class="line">                &quot;UpperDir&quot;: &quot;/var/lib/docker/overlay2/b0e04902fbfbca7b31445142b80d8b81910b7d47349eddc3b79f0ac3550baf88/diff&quot;,</span><br><span class="line">                &quot;WorkDir&quot;: &quot;/var/lib/docker/overlay2/b0e04902fbfbca7b31445142b80d8b81910b7d47349eddc3b79f0ac3550baf88/work&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;Name&quot;: &quot;overlay2&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Mounts&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;Type&quot;: &quot;volume&quot;,</span><br><span class="line">                &quot;Name&quot;: &quot;207eca442c7383941a1904df277bb6c660c004d2012fc823714e4b66fe0c9368&quot;,</span><br><span class="line">                &quot;Source&quot;: &quot;/var/lib/docker/volumes/207eca442c7383941a1904df277bb6c660c004d2012fc823714e4b66fe0c9368/_data&quot;,</span><br><span class="line">                &quot;Destination&quot;: &quot;/data&quot;,</span><br><span class="line">                &quot;Driver&quot;: &quot;local&quot;,</span><br><span class="line">                &quot;Mode&quot;: &quot;&quot;,</span><br><span class="line">                &quot;RW&quot;: true,</span><br><span class="line">                &quot;Propagation&quot;: &quot;&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        &quot;Config&quot;: &#123;</span><br><span class="line">            &quot;Hostname&quot;: &quot;cf0cf2d3eff2&quot;,</span><br><span class="line">            &quot;Domainname&quot;: &quot;&quot;,</span><br><span class="line">            &quot;User&quot;: &quot;&quot;,</span><br><span class="line">            &quot;AttachStdin&quot;: false,</span><br><span class="line">            &quot;AttachStdout&quot;: false,</span><br><span class="line">            &quot;AttachStderr&quot;: false,</span><br><span class="line">            &quot;ExposedPorts&quot;: &#123;</span><br><span class="line">                &quot;6379/tcp&quot;: &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;Tty&quot;: true,</span><br><span class="line">            &quot;OpenStdin&quot;: true,</span><br><span class="line">            &quot;StdinOnce&quot;: false,</span><br><span class="line">            &quot;Env&quot;: [</span><br><span class="line">                &quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;,</span><br><span class="line">                &quot;GOSU_VERSION=1.12&quot;,</span><br><span class="line">                &quot;REDIS_VERSION=6.2.1&quot;,</span><br><span class="line">                &quot;REDIS_DOWNLOAD_URL=http://download.redis.io/releases/redis-6.2.1.tar.gz&quot;,</span><br><span class="line">                &quot;REDIS_DOWNLOAD_SHA=cd222505012cce20b25682fca931ec93bd21ae92cb4abfe742cf7b76aa907520&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;Cmd&quot;: [</span><br><span class="line">                &quot;redis-server&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;Image&quot;: &quot;redis&quot;,</span><br><span class="line">            &quot;Volumes&quot;: &#123;</span><br><span class="line">                &quot;/data&quot;: &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;WorkingDir&quot;: &quot;/data&quot;,</span><br><span class="line">            &quot;Entrypoint&quot;: [</span><br><span class="line">                &quot;docker-entrypoint.sh&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;OnBuild&quot;: null,</span><br><span class="line">            &quot;Labels&quot;: &#123;&#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;NetworkSettings&quot;: &#123;</span><br><span class="line">            &quot;Bridge&quot;: &quot;&quot;,</span><br><span class="line">            &quot;SandboxID&quot;: &quot;f0d624e7b6a6725aaa92e339314db32854d031acd7742f619eb58ad9829807a4&quot;,</span><br><span class="line">            &quot;HairpinMode&quot;: false,</span><br><span class="line">            &quot;LinkLocalIPv6Address&quot;: &quot;&quot;,</span><br><span class="line">            &quot;LinkLocalIPv6PrefixLen&quot;: 0,</span><br><span class="line">            &quot;Ports&quot;: &#123;</span><br><span class="line">                &quot;6379/tcp&quot;: null</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;SandboxKey&quot;: &quot;/var/run/docker/netns/f0d624e7b6a6&quot;,</span><br><span class="line">            &quot;SecondaryIPAddresses&quot;: null,</span><br><span class="line">            &quot;SecondaryIPv6Addresses&quot;: null,</span><br><span class="line">            &quot;EndpointID&quot;: &quot;abc67c99fadfdcd2b85a26dbc9c8544b97cb8dc591f191796996b1591cc525d2&quot;,</span><br><span class="line">            &quot;Gateway&quot;: &quot;172.17.0.1&quot;,</span><br><span class="line">            &quot;GlobalIPv6Address&quot;: &quot;&quot;,</span><br><span class="line">            &quot;GlobalIPv6PrefixLen&quot;: 0,</span><br><span class="line">            &quot;IPAddress&quot;: &quot;172.17.0.2&quot;,</span><br><span class="line">            &quot;IPPrefixLen&quot;: 16,</span><br><span class="line">            &quot;IPv6Gateway&quot;: &quot;&quot;,</span><br><span class="line">            &quot;MacAddress&quot;: &quot;02:42:ac:11:00:02&quot;,</span><br><span class="line">            &quot;Networks&quot;: &#123;</span><br><span class="line">                &quot;bridge&quot;: &#123;</span><br><span class="line">                    &quot;IPAMConfig&quot;: null,</span><br><span class="line">                    &quot;Links&quot;: null,</span><br><span class="line">                    &quot;Aliases&quot;: null,</span><br><span class="line">                    &quot;NetworkID&quot;: &quot;8a8b46d2a60365d4e59517c0f49bfd1e49d789c22c6bc3c13555cc42399e14c4&quot;,</span><br><span class="line">                    &quot;EndpointID&quot;: &quot;abc67c99fadfdcd2b85a26dbc9c8544b97cb8dc591f191796996b1591cc525d2&quot;,</span><br><span class="line">                    &quot;Gateway&quot;: &quot;172.17.0.1&quot;,</span><br><span class="line">                    &quot;IPAddress&quot;: &quot;172.17.0.2&quot;,</span><br><span class="line">                    &quot;IPPrefixLen&quot;: 16,</span><br><span class="line">                    &quot;IPv6Gateway&quot;: &quot;&quot;,</span><br><span class="line">                    &quot;GlobalIPv6Address&quot;: &quot;&quot;,</span><br><span class="line">                    &quot;GlobalIPv6PrefixLen&quot;: 0,</span><br><span class="line">                    &quot;MacAddress&quot;: &quot;02:42:ac:11:00:02&quot;,</span><br><span class="line">                    &quot;DriverOpts&quot;: null</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h3 id="查看日志"><a href="#查看日志" class="headerlink" title="查看日志"></a>查看日志</h3><p><code>docker logs  -f redis1</code></p>
<p>-f  挂起这个终端，动态查看日志</p>
<h1 id="Docker-commit方法镜像制作"><a href="#Docker-commit方法镜像制作" class="headerlink" title="Docker commit方法镜像制作"></a>Docker commit方法镜像制作</h1><h2 id="前期准备"><a href="#前期准备" class="headerlink" title="前期准备"></a>前期准备</h2><h3 id="下载一个centos镜像，进入容器，安装wget"><a href="#下载一个centos镜像，进入容器，安装wget" class="headerlink" title="下载一个centos镜像，进入容器，安装wget"></a>下载一个centos镜像，进入容器，安装wget</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker pull centos</span><br><span class="line">docker run -it centos bash</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@local ~]# docker run -it centos bash</span><br><span class="line">[root@c98ecb53707d yum.repos.d]# yum install wget -y	#安装wget，默认没有wget安装</span><br></pre></td></tr></table></figure>
<h3 id="安装软件源"><a href="#安装软件源" class="headerlink" title="安装软件源"></a>安装软件源</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@c98ecb53707d home]# cd /etc/yum.repos.d/      </span><br><span class="line">[root@c98ecb53707d yum.repos.d]# ls</span><br><span class="line">CentOS-Linux-AppStream.repo  CentOS-Linux-ContinuousRelease.repo  CentOS-Linux-Devel.repo   CentOS-Linux-FastTrack.repo         CentOS-Linux-Media.repo  CentOS-Linux-PowerTools.repo</span><br><span class="line">CentOS-Linux-BaseOS.repo     CentOS-Linux-Debuginfo.repo          CentOS-Linux-Extras.repo  CentOS-Linux-HighAvailability.repo  CentOS-Linux-Plus.repo   CentOS-Linux-Sources.repo</span><br><span class="line">[root@c98ecb53707d yum.repos.d]# mkdir backup #备份文件夹</span><br><span class="line">[root@c98ecb53707d yum.repos.d]# mv C* /etc/yum.repos.d/backup/ #执行备份</span><br><span class="line">[root@c98ecb53707d yum.repos.d]# wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo #设置阿里云镜像</span><br><span class="line">[root@c98ecb53707d yum.repos.d]# cat /etc/redhat-release #查看发行版本</span><br><span class="line">CentOS Linux release 8.3.2011</span><br><span class="line">[root@c98ecb53707d yum.repos.d]# wget https://mirrors.aliyun.com/centos/8.3.2011/extras/x86_64/os/Packages/epel-release-8-8.el8.noarch.rpm</span><br></pre></td></tr></table></figure>
<h3 id="安装软件"><a href="#安装软件" class="headerlink" title="安装软件"></a>安装软件</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install nginx -y</span><br></pre></td></tr></table></figure>
<h2 id="制作镜像"><a href="#制作镜像" class="headerlink" title="制作镜像"></a>制作镜像</h2><p>说明，下面制作镜像先用之前的nginx镜像做的副本，下面才是centos镜像</p>
<h3 id="使用docker-commit-来提交容器副本"><a href="#使用docker-commit-来提交容器副本" class="headerlink" title="使用docker commit 来提交容器副本"></a>使用docker commit 来提交容器副本</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker commit [OPTIONS] CONTAINER [REPOSITORY[:TAG]]</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@local ~]# docker ps -a #查看容器</span><br><span class="line">CONTAINER ID   IMAGE          COMMAND                  CREATED          STATUS                        PORTS                 NAMES</span><br><span class="line">daed8dd73440   centos         &quot;bash&quot;                   49 seconds ago   Up 48 seconds                         nice_feynman</span><br><span class="line"></span><br><span class="line">[root@local ~]# docker commit -m &#x27;add nginx images&#x27; daed8dd73440  tanhao/my_nginx         # 提交容器</span><br><span class="line">sha256:c40cd4ab1240a10eec1e89146b719fe60fd6b5ff1010e298fc1cb71e15ae7724</span><br><span class="line">[root@local ~]# docker images # 查看</span><br><span class="line">REPOSITORY        TAG       IMAGE ID       CREATED         SIZE</span><br><span class="line">tanhao/my_nginx   latest    c40cd4ab1240   2 minutes ago   209MB</span><br><span class="line">[root@local ~]# docker run -it  --name centos-nginx tanhao/my_nginx  /bin/bash  # 运行提交后的容器</span><br></pre></td></tr></table></figure>
<h3 id="制作好的镜像可以上传官网"><a href="#制作好的镜像可以上传官网" class="headerlink" title="制作好的镜像可以上传官网"></a>制作好的镜像可以上传官网</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker login https:hub.docker.com</span><br><span class="line">docker tag c40cd4ab1240 docker.io/myname/mynginx　　　　　　#打标签</span><br><span class="line">docker push docker.io/myname/mynginx</span><br></pre></td></tr></table></figure>
<h1 id="Docker-Dockerfile创建镜像的方法（推荐docker-file这种方法）"><a href="#Docker-Dockerfile创建镜像的方法（推荐docker-file这种方法）" class="headerlink" title="Docker Dockerfile创建镜像的方法（推荐docker file这种方法）"></a>Docker Dockerfile创建镜像的方法（推荐docker file这种方法）</h1><h2 id="docker-file方法制作镜像"><a href="#docker-file方法制作镜像" class="headerlink" title="docker file方法制作镜像"></a>docker file方法制作镜像</h2><h3 id="什么是docker-file"><a href="#什么是docker-file" class="headerlink" title="什么是docker file"></a>什么是docker file</h3><p>用来全自动构建镜像文件，命名为Dockerfile</p>
<h3 id="Dockerfile-文件编写指令及语法"><a href="#Dockerfile-文件编写指令及语法" class="headerlink" title="Dockerfile 文件编写指令及语法"></a>Dockerfile 文件编写指令及语法</h3><p><a href="https://blog.huixing.org/introduction-to-docker-instructions/">https://blog.huixing.org/introduction-to-docker-instructions/</a></p>
<h3 id="实战编写"><a href="#实战编写" class="headerlink" title="实战编写"></a>实战编写</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@local ~]# vi Dockerfile </span><br><span class="line">#this is docker file for centos-nginx</span><br><span class="line">FROM centos</span><br><span class="line">MAINTAINER th  &lt;victor@docker.com&gt;</span><br><span class="line">RUN yum install wget -y</span><br><span class="line">RUN rpm -ivh https://mirrors.aliyun.com/epel/epel-release-latest-7.noarch.rpm</span><br><span class="line">RUN yum install nginx -y</span><br><span class="line">ADD index.html /usr/share/nginx/html/index.html</span><br><span class="line">RUN echo &quot;daemon off;&quot;&gt;&gt;/etc/nginx/nginx.conf</span><br><span class="line">EXPOSE 80</span><br><span class="line">CMD [&quot;nginx&quot;]</span><br></pre></td></tr></table></figure>
<h3 id="构建"><a href="#构建" class="headerlink" title="构建"></a>构建</h3><p>语法<br><code>docker build [OPTIONS] PATH | URL | -</code></p>
<p>完整过程我就不贴了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@local ~]# docker build -t tanhao/nginx1 .          </span><br><span class="line">Sending build context to Docker daemon  311.8kB</span><br><span class="line">Step 1/9 : FROM centos</span><br><span class="line"> ---&gt; 300e315adb2f</span><br><span class="line">Step 2/9 : MAINTAINER zxg  &lt;victor@docker.com&gt;</span><br><span class="line"> ---&gt; Running in e7547fa54cc6</span><br><span class="line">Removing intermediate container e7547fa54cc6</span><br><span class="line"> ---&gt; f192af41dbef</span><br><span class="line">Step 3/9 : RUN yum install wget -y</span><br><span class="line"></span><br><span class="line">[root@local ~]# docker images</span><br><span class="line">REPOSITORY      TAG       IMAGE ID       CREATED          SIZE</span><br><span class="line">tanhao/nginx1   latest    7f8119f7c460   12 seconds ago   368MB</span><br></pre></td></tr></table></figure>
<h3 id="验证一下"><a href="#验证一下" class="headerlink" title="验证一下"></a>验证一下</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@local ~]# docker run -d --name my_nginx1 tanhao/nginx1 #后台运行整个容器</span><br><span class="line">55cae2283e289bb8f2a30d354930ba0765c476c51bc6b89b1a99060177f7491d</span><br><span class="line">[root@local ~]# docker exec -it my_nginx1 bash #进入容器</span><br><span class="line">[root@55cae2283e28 /]# cat /usr/share/nginx/html/index.html #查看文件是否添加到容器</span><br><span class="line">hahahaha</span><br><span class="line">[root@55cae2283e28 /]# curl 127.0.0.1 #查看nginx是否正常</span><br><span class="line">hahahaha</span><br></pre></td></tr></table></figure>
<p>容器外查看一下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@local ~]# docker inspect my_nginx1 |grep IPAddress</span><br><span class="line">            &quot;SecondaryIPAddresses&quot;: null,</span><br><span class="line">            &quot;IPAddress&quot;: &quot;172.17.0.3&quot;,</span><br><span class="line">                    &quot;IPAddress&quot;: &quot;172.17.0.3&quot;,</span><br><span class="line">[root@local ~]# curl 172.17.0.3</span><br><span class="line">hahahaha</span><br></pre></td></tr></table></figure>
<h1 id="Docker私库的搭建及常用方法"><a href="#Docker私库的搭建及常用方法" class="headerlink" title="Docker私库的搭建及常用方法"></a>Docker私库的搭建及常用方法</h1><h2 id="简单介绍"><a href="#简单介绍" class="headerlink" title="简单介绍"></a>简单介绍</h2><p>私库的好处有几点</p>
<ol>
<li>节约带宽</li>
<li>可以自己定制系统</li>
<li>更加安全</li>
</ol>
<h2 id="搭建私库的两种方法"><a href="#搭建私库的两种方法" class="headerlink" title="搭建私库的两种方法"></a>搭建私库的两种方法</h2><ol>
<li><p>利用官方提供的工具docker-registry来配置私库</p>
<p>官方提供的镜像，注意这个工具是个镜像，直接下载并使用registry镜像启动docker实例就可以了</p>
</li>
<li><p>利用Harbor-Registry，来搭建私库</p>
<p> Harbor是一个用于存储Docker镜像的企业级Registry服务</p>
</li>
</ol>
<h2 id="通过官方docker-registry来配置私库"><a href="#通过官方docker-registry来配置私库" class="headerlink" title="通过官方docker-registry来配置私库"></a>通过官方docker-registry来配置私库</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost yum.repos.d]# docker pull registry	# 拉取registry</span><br><span class="line">Using default tag: latest</span><br><span class="line">latest: Pulling from library/registry</span><br><span class="line">e95f33c60a64: Pull complete </span><br><span class="line">4d7f2300f040: Pull complete </span><br><span class="line">35a7b7da3905: Pull complete </span><br><span class="line">d656466e1fe8: Pull complete </span><br><span class="line">b6cb731e4f93: Pull complete </span><br><span class="line">Digest: sha256:da946ca03fca0aade04a73aa94b54ff0dc614216bdd1d47585f97b4c1bdaa0e2</span><br><span class="line">Status: Downloaded newer image for registry:latest</span><br><span class="line">docker.io/library/registry:latest</span><br><span class="line">[root@localhost yum.repos.d]# docker images		# 查看</span><br><span class="line">REPOSITORY   TAG       IMAGE ID       CREATED       SIZE</span><br><span class="line">registry     latest    5c4008a25e05   2 weeks ago   26.2MB</span><br><span class="line">[root@localhost ~]# docker run -d -v registry -p 5000:5000 --restart=always --name registry registry:latest	# 创建registry容器</span><br><span class="line">[root@localhost yum.repos.d]# curl http://127.0.0.1:5000/v2/</span><br><span class="line">&#123;&#125;	# 查看registry容器状态</span><br></pre></td></tr></table></figure>
<p>接着我们使用docker push命令来推送自己的镜像到本地注册中心.<br>推送过程可能会不成功即出现下面这种情况getsocket:connection refused.</p>
<h2 id="通过harbor-registry方式来配置私库"><a href="#通过harbor-registry方式来配置私库" class="headerlink" title="通过harbor-registry方式来配置私库"></a>通过harbor-registry方式来配置私库</h2>
    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/mobile-safari-download-issue-the-operation-couldn-t-be-completed-webkitblobr/" rel="prev" title="Safari 手机版下载提示 Mobile Safari download issue : The operation couldn’t be completed. (webkitblobresource error 1.)">
      <i class="fa fa-chevron-left"></i> Safari 手机版下载提示 Mobile Safari download issue : The operation couldn’t be completed. (webkitblobresource error 1.)
    </a></div>
      <div class="post-nav-item">
    <a href="/elasticsearch_vs_solr_vs_sphinx/" rel="next" title="ElasticSearch VS. Solr VS. Sphinx：最好的开源搜索引擎比较">
      ElasticSearch VS. Solr VS. Sphinx：最好的开源搜索引擎比较 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    
  <div class="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
    </div>
  </div>
  

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Docker-%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E5%8F%8A%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8"><span class="nav-number">1.</span> <span class="nav-text">Docker 架构原理及简单使用</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AE%80%E4%BB%8B"><span class="nav-number">1.1.</span> <span class="nav-text">简介</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%86%E8%A7%A3docker%E7%9A%84%E5%89%8D%E7%94%9FLXC"><span class="nav-number">1.1.1.</span> <span class="nav-text">了解docker的前生LXC</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#LXC%E4%B8%8Edocker%E4%BB%80%E4%B9%88%E5%85%B3%E7%B3%BB%EF%BC%9F"><span class="nav-number">1.1.2.</span> <span class="nav-text">LXC与docker什么关系？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFdocker"><span class="nav-number">1.1.3.</span> <span class="nav-text">什么是docker</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88docker%E8%B6%8A%E6%9D%A5%E8%B6%8A%E5%8F%97%E6%AC%A2%E8%BF%8E"><span class="nav-number">1.1.4.</span> <span class="nav-text">为什么docker越来越受欢迎</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#docker%E7%89%88%E6%9C%AC"><span class="nav-number">1.1.5.</span> <span class="nav-text">docker版本</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#docker%E5%92%8Copenstack%E7%9A%84%E5%87%A0%E9%A1%B9%E5%AF%B9%E6%AF%94"><span class="nav-number">1.1.6.</span> <span class="nav-text">docker和openstack的几项对比</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%B9%E5%99%A8%E5%9C%A8%E5%86%85%E6%A0%B8%E4%B8%AD%E6%94%AF%E6%8C%812%E7%A7%8D%E9%87%8D%E8%A6%81%E6%8A%80%E6%9C%AF"><span class="nav-number">1.1.7.</span> <span class="nav-text">容器在内核中支持2种重要技术</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%86%E8%A7%A3docker%E4%B8%89%E4%B8%AA%E9%87%8D%E8%A6%81%E6%A6%82%E5%BF%B5"><span class="nav-number">1.1.8.</span> <span class="nav-text">了解docker三个重要概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#docker%E7%9A%84%E4%B8%BB%E8%A6%81%E7%94%A8%E9%80%94"><span class="nav-number">1.1.9.</span> <span class="nav-text">docker的主要用途</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#docker%E6%94%B9%E5%8F%98%E4%BA%86%E4%BB%80%E4%B9%88"><span class="nav-number">1.1.10.</span> <span class="nav-text">docker改变了什么</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#docker%E6%9E%B6%E6%9E%84"><span class="nav-number">1.2.</span> <span class="nav-text">docker架构</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84"><span class="nav-number">1.2.1.</span> <span class="nav-text">总体架构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#docker%E6%9E%B6%E6%9E%841"><span class="nav-number">1.2.2.</span> <span class="nav-text">docker架构1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#docker%E6%9E%B6%E6%9E%842"><span class="nav-number">1.2.3.</span> <span class="nav-text">docker架构2</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#docker%E6%9E%B6%E6%9E%842%E5%90%84%E4%B8%AA%E6%A8%A1%E5%9D%97%E7%9A%84%E5%8A%9F%E8%83%BD"><span class="nav-number">1.3.</span> <span class="nav-text">docker架构2各个模块的功能</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#docker%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8"><span class="nav-number">1.4.</span> <span class="nav-text">docker简单使用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85"><span class="nav-number">1.4.1.</span> <span class="nav-text">安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#docker%E7%89%88%E6%9C%AC%E6%9F%A5%E8%AF%A2"><span class="nav-number">1.4.2.</span> <span class="nav-text">docker版本查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%90%9C%E7%B4%A2%E4%B8%8B%E8%BD%BD%E9%95%9C%E5%83%8F"><span class="nav-number">1.4.3.</span> <span class="nav-text">搜索下载镜像</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E5%B7%B2%E7%BB%8F%E4%B8%8B%E8%BD%BD%E7%9A%84%E9%95%9C%E5%83%8F"><span class="nav-number">1.4.4.</span> <span class="nav-text">查看已经下载的镜像</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%BC%E5%87%BA%E9%95%9C%E5%83%8F"><span class="nav-number">1.4.5.</span> <span class="nav-text">导出镜像</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E9%95%9C%E5%83%8F"><span class="nav-number">1.4.6.</span> <span class="nav-text">删除镜像</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%BC%E5%85%A5%E9%95%9C%E5%83%8F"><span class="nav-number">1.4.7.</span> <span class="nav-text">导入镜像</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%BB%98%E8%AE%A4%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-number">1.4.8.</span> <span class="nav-text">默认配置文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%90%E8%A1%8C%E4%B8%80%E4%B8%AA%E5%AE%B9%E5%99%A8-run"><span class="nav-number">1.4.9.</span> <span class="nav-text">运行一个容器-run</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E8%BF%9B%E5%85%A5%E5%AE%B9%E5%99%A8"><span class="nav-number">1.4.10.</span> <span class="nav-text">如何进入容器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8Bdocker%E8%BF%9B%E7%A8%8B%E5%8F%8A%E5%88%A0%E9%99%A4%E5%AE%B9%E5%99%A8"><span class="nav-number">1.4.11.</span> <span class="nav-text">查看docker进程及删除容器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E5%AE%B9%E5%99%A8%E8%AF%A6%E7%BB%86%E4%BF%A1%E6%81%AF"><span class="nav-number">1.4.12.</span> <span class="nav-text">查看容器详细信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E6%97%A5%E5%BF%97"><span class="nav-number">1.4.13.</span> <span class="nav-text">查看日志</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Docker-commit%E6%96%B9%E6%B3%95%E9%95%9C%E5%83%8F%E5%88%B6%E4%BD%9C"><span class="nav-number">2.</span> <span class="nav-text">Docker commit方法镜像制作</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E6%9C%9F%E5%87%86%E5%A4%87"><span class="nav-number">2.1.</span> <span class="nav-text">前期准备</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%8B%E8%BD%BD%E4%B8%80%E4%B8%AAcentos%E9%95%9C%E5%83%8F%EF%BC%8C%E8%BF%9B%E5%85%A5%E5%AE%B9%E5%99%A8%EF%BC%8C%E5%AE%89%E8%A3%85wget"><span class="nav-number">2.1.1.</span> <span class="nav-text">下载一个centos镜像，进入容器，安装wget</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E8%BD%AF%E4%BB%B6%E6%BA%90"><span class="nav-number">2.1.2.</span> <span class="nav-text">安装软件源</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E8%BD%AF%E4%BB%B6"><span class="nav-number">2.1.3.</span> <span class="nav-text">安装软件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%B6%E4%BD%9C%E9%95%9C%E5%83%8F"><span class="nav-number">2.2.</span> <span class="nav-text">制作镜像</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8docker-commit-%E6%9D%A5%E6%8F%90%E4%BA%A4%E5%AE%B9%E5%99%A8%E5%89%AF%E6%9C%AC"><span class="nav-number">2.2.1.</span> <span class="nav-text">使用docker commit 来提交容器副本</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%B6%E4%BD%9C%E5%A5%BD%E7%9A%84%E9%95%9C%E5%83%8F%E5%8F%AF%E4%BB%A5%E4%B8%8A%E4%BC%A0%E5%AE%98%E7%BD%91"><span class="nav-number">2.2.2.</span> <span class="nav-text">制作好的镜像可以上传官网</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Docker-Dockerfile%E5%88%9B%E5%BB%BA%E9%95%9C%E5%83%8F%E7%9A%84%E6%96%B9%E6%B3%95%EF%BC%88%E6%8E%A8%E8%8D%90docker-file%E8%BF%99%E7%A7%8D%E6%96%B9%E6%B3%95%EF%BC%89"><span class="nav-number">3.</span> <span class="nav-text">Docker Dockerfile创建镜像的方法（推荐docker file这种方法）</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#docker-file%E6%96%B9%E6%B3%95%E5%88%B6%E4%BD%9C%E9%95%9C%E5%83%8F"><span class="nav-number">3.1.</span> <span class="nav-text">docker file方法制作镜像</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFdocker-file"><span class="nav-number">3.1.1.</span> <span class="nav-text">什么是docker file</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Dockerfile-%E6%96%87%E4%BB%B6%E7%BC%96%E5%86%99%E6%8C%87%E4%BB%A4%E5%8F%8A%E8%AF%AD%E6%B3%95"><span class="nav-number">3.1.2.</span> <span class="nav-text">Dockerfile 文件编写指令及语法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E6%88%98%E7%BC%96%E5%86%99"><span class="nav-number">3.1.3.</span> <span class="nav-text">实战编写</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9E%84%E5%BB%BA"><span class="nav-number">3.1.4.</span> <span class="nav-text">构建</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AA%8C%E8%AF%81%E4%B8%80%E4%B8%8B"><span class="nav-number">3.1.5.</span> <span class="nav-text">验证一下</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Docker%E7%A7%81%E5%BA%93%E7%9A%84%E6%90%AD%E5%BB%BA%E5%8F%8A%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95"><span class="nav-number">4.</span> <span class="nav-text">Docker私库的搭建及常用方法</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AE%80%E5%8D%95%E4%BB%8B%E7%BB%8D"><span class="nav-number">4.1.</span> <span class="nav-text">简单介绍</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%90%AD%E5%BB%BA%E7%A7%81%E5%BA%93%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%96%B9%E6%B3%95"><span class="nav-number">4.2.</span> <span class="nav-text">搭建私库的两种方法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%80%9A%E8%BF%87%E5%AE%98%E6%96%B9docker-registry%E6%9D%A5%E9%85%8D%E7%BD%AE%E7%A7%81%E5%BA%93"><span class="nav-number">4.3.</span> <span class="nav-text">通过官方docker-registry来配置私库</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%80%9A%E8%BF%87harbor-registry%E6%96%B9%E5%BC%8F%E6%9D%A5%E9%85%8D%E7%BD%AE%E7%A7%81%E5%BA%93"><span class="nav-number">4.4.</span> <span class="nav-text">通过harbor-registry方式来配置私库</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">作者</p>
  <div class="site-description" itemprop="description">谈浩的个人博客</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">51</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="http://huixing.org" title="http://huixing.org" rel="noopener" target="_blank">彗星网</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">tanhao</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  
  <script>
    (function(){
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x=document.getElementsByTagName("link");
		//Find the last canonical URL
		if(x.length > 0){
			for (i=0;i<x.length;i++){
				if(x[i].rel.toLowerCase() == 'canonical' && x[i].href){
					canonicalURL=x[i].href;
				}
			}
		}
    //Get protocol
	    if (!canonicalURL){
	    	curProtocol = window.location.protocol.split(':')[0];
	    }
	    else{
	    	curProtocol = canonicalURL.split(':')[0];
	    }
      //Get current URL if the canonical URL does not exist
	    if (!canonicalURL) canonicalURL = window.location.href;
	    //Assign script content. Replace current URL with the canonical URL
      !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=canonicalURL,t=document.referrer;if(!e.test(r)){var n=(String(curProtocol).toLowerCase() === 'https')?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";t?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var i=new Image;i.src=n}}(window);})();
  </script>















  

  

<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://huixing-org.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>
<script>
  var disqus_config = function() {
    this.page.url = "http://blog.huixing.org/docker-head-first/";
    this.page.identifier = "docker-head-first/";
    this.page.title = "Docker 深入浅出";
    };
  NexT.utils.loadComments(document.querySelector('#disqus_thread'), () => {
    if (window.DISQUS) {
      DISQUS.reset({
        reload: true,
        config: disqus_config
      });
    } else {
      var d = document, s = d.createElement('script');
      s.src = 'https://huixing-org.disqus.com/embed.js';
      s.setAttribute('data-timestamp', '' + +new Date());
      (d.head || d.body).appendChild(s);
    }
  });
</script>

</body>
</html>
